---
title: "교착 상태와 기아 상태"
date: 2020-07-05 22:32:28 -0400
categories: OS_Study
---

# 교착 상태의 개념

 - 결코 일어나지 않을 사건을 기다리는 상태
 - 운영체제가 해결하지 못할 경우 외부 간섭으로 해결해야 함
 - 두개 이상의 프로세스가 사용하는 자원(비공유)을 서로 기다리고 있을 때 발생함



# 교착 상태의 발생 조건

 - 다음의 네 가지 조건을 만족할 때 발생하며, 1~3만 만족해도 발생할 수 있음
 - 4는 1~3 조건을 만족할 때 발생할 수 있는 결과이고, 점유와 대기 조건을 포함하므로 네 가지 조건이 모두 독립적인 것은 아님
 	- 상호배제 : 자원을 최소 하나 이상 비공유해야 함. 즉, 한 번에 프로세스 하나만 해당 자원을 사용할 수 있어야 함
 	- 점유와 대기 : 자원을 최소한 하나 정도는 보유하고, 다른 프로세스에 할당된 자원을 얻으려고 기다리는 프로세스가 있어야 함
 	- 비선점 : 자원을 강제로 빼앗을 수 없고, 자원을 점유하고 있는 프로세스가 끝나야 해제됨
 	- 순환(환형) 대기 : P0는 P1이 보유한 자원을, P1은 P2가 보유한 자원을, ..., 프로세스 Pn-1은 Pn이 보유한 자원을, Pn은 P0의 자원을 얻으려ㅑ고 하는 상태




* * *

# 교착상태 예방
 - 교착 상태 네 가지 조건이 하나라도 발생하지 않도록 하면 교착 상태를 예방할 수 있음
 - 상호배제 문제는 고려하여 프로세스가 원하는 자원을 배타적으로 사용하려고 하는 것은 제외시켜야 함
 - 보통 교착 상태는 다음 네 가지 방법으로 예방 가능
 	- 자원의 상호배제 조건 방지
 	- 점유와 대기 조건 방지
 	- 비선점 조건 방지
 	- 순환(환형) 대기 조건 방지

 - 자원의 상호배제 조건 방지
 	- 상호배제는 자원의 비공유가 전제되어야 함
 	- 일반적으로 상호배제 조건을 만족하지 않으면 교착 상태를 예방할 수 없음

 - 점유와 대기 조건 방지
 	- 해당 조건이 발생하지 않으려면, 프로세스가 작업을 수행하기 전에 필요한 자원을 모두 요청하고 획득해야 함
 	- 프로세스가 실행에 필요한 자원을 한꺼번에 요구하고 허용할 때까지 작업을 보류하여 대기 조건이 성립하지 않도록 하는 것
 	- 또는 프로세스가 자원을 전혀 가지고 있지 않을 때만 자원 요청을 허용하는 것
 	- 두 가지 단점이 발생함
 		- 자원의 효율성이 너무 낮음. 많은 자원이 사용되는 것도 아닌데, 오랫동안 할당되어 있어야 함
 		- 기아 상태가 발생할 수 있음

 - 비선점 조건 방지
 	- 전제 조건 : 이미 할당된 자원에 선점권이 없어야 함
 		- 어떤 자원을 가진 프로세스가 다른 자원을 요청할 때 요청한 자원을 즉시 할당받을 수 없어 기다려야 한다면, 프로세스는 현재 가진 자원을 모두 해제해야함
 		- 그리고 프로세스가 작업을 시작할 때는 요청한 새로운 자원과 해제한 자원을 확보해야 함
 		- 비선점 조건을 효과적으로 무효화시키지만 이미 실행한 작업의 상태를 잃을 수도 있음

 - 순환(환형) 대기 조건 방지
 	- 모든 자원에 일련의 순서를 부여하고 각 프로세스가 오름차순으로만 자원을 요청할 수 있게 함
 	- 계층적 요청 방법으로 순환 대기의 가능성을 제거하여 교착 상태를 

이후 나오는 회피 방법은 덜 엄격한 조건을 요구하여 자원을 좀 더 효율적으로 사용하는 것이 목적



# 교착 상태의 발생 조건

 - 교착 상태가 발생할 가능성을 인정하고, 교착상태가 발생하려고 할 때 적절히 회피
 	- 프로세스의 시작 중단 : 프로세스의 요구가 교착 상태를 발생시킬 수 있다면 프로세스 시작을 중단함
 	- 자원 할당 거부 : 프로세스가 요청한 자원을 할당했을 때 교착 상태가 발생할 수 있다면 요청한 자원을 할당하지 않음. 이를 은행가 알고리즘이라 함

 - 프로세스의 시작 중단
 	- 교착 상태를 회피하려면 자원을 언제 요청하는지 추가 정보가 필요
 	- 각 프로세스마다 요청과 해제에서 정확한 순서를 파악하고 있다면, 요청에 따른 프로세스 대기 여부를 결정할 수 있음
 	- 요청 수락 혹은 대기 여부는 현재 사용 가능한 자원, 프로세스에 할당된 자원 등 각 프로세스에 대한 자원의 요청과 해제를 미리 알고 있어야 결정 가능함
 	- 교착 상태 회피 알고리즘은 시스템이 순환 대기 조건이 발생하지 않도록 자원 할당 상태를 검사함
 	
 - 자원 할당 거부(은행가 알고리즘)
 	- 자원의 할당 허용 여부를 결정하기 전에 미리 결정된 모든 자원의 최대 가능한 할당량을 시뮬레이션하여 안전 여부를 검사함
 	- 이후 대기 중인 다른 모든 활동의 교착 상태 가능성을 조사하여 안전 상태 여부를 검사 및 확인함
 	- 다음의 자료구조가 필요함
 		- Available : 각 형태별로 사용 가능한 자원 수를 표시하는 길이가 m인 벡터
 		- Max : 각 프로세스 자원의 최대 요청량을 표시하는 n\*m 행렬
 		- Allocation : 현재 각 프로세스에 할당되어 있는 각 형태의 자원 수를 정의하는 n\*m 행렬
 		- Need : 각 프로세스에 남아 있는 자원 요청을 표시하는 n\*m 행렬
 	- 프로세스 Pi가 자원을 요청하면 다음 동작이 일어남
		1. Request <= Need면 2단계로 이동, 아니면 프로세스가 최대 요청치를 초과하기 때문에 오류
		2. Request <= Available이면 3단계로, 아니면 자원이 부족하기 때문에 Pi 대기
		3. 요청된 자원을 프로세스 Pi에 할당함

 	- 안전 알고리즘은 시스템이 안정 상태인지 불안정 상태인지 검사함
		1. Work와 Finish를 각각 길이가 m과 n인 벡터일때, Work=Available, Finish[i] = false, i=1, 2, ..., n이 되도록 초기화
		2. 다음 조건을 만족하는 i 값을 찾고, 없으면 4로 이동
			- Finish[i]==false, Needi <= Work
		3. 다음을 수행하고 2단계로 이동
			- Work = Work + Allocationi, Finish[i] = true
		4. 모든 i에 대하여 Finish[i]==true이면 시스템은 안정 상태이다



# 교착 상태의 발생 조건

 - 교착 상태 탐지 알고리즘
 - 교착 상태 회복 방법
 	 - 프로세스 중단
 	 	- 교착 상태 프로세스를 모두 중단
 	 	- 한 프로세스씩 중단
 	 - 자원 선점
 	 	- 선점 자원 선택 : 프로세스를 종료할 때 비용을 최소화하려면 적절한 선점 순서를 결정해야 함
 	 	- 복귀 : 필요한 자원을 잃는 프로세스는 정상 실행 불능. 따라서 프로세스를 안정 상태로 복귀시키고 다시 시작해야 함
 	 	- 기아 : 동일한 프로세스가 자원들을 항상 선점하지 않도록 보장하려고 할 때 비용이 기반인 시스템에서는 동일한 프로세스를 희생자로 선택. 그러면 해당 프로세스는 작업을 완료하지 못하는 기아 상태가 되어 시스템 조치를 요청함

